version: 2

sources:
  - name: thelook_ecommerce
    database: bigquery-public-data
    tables:
      - name: inventory_items
      - name: order_items
      - name: orders
      - name: products
      - name: users
      - name: events
        freshness:
          warn_after: { count: 12, period: hour }
          error_after: {count: 24, period: hour}
        loaded_at_field: created_at
        filter: "created_at >= '2025-10-01" #filter only applies to freshness check

unit_tests:
  - name: test_profit_and_discounts
    description: "Check that we're calculating profits and discounts correctly"
    model: int_ecommerce__order_items_products
    given:
      - input: ref('stg_ecommerce__products')
        rows:
          - {product_id: 1234, cost: 5, retail_price: 10} #dummy data
      - input: ref('stg_ecommerce__order_items')
        rows:
          - {product_id: 1234, item_sale_price: 7}
    expect:
      rows:
        - {item_profit: 2, item_discount: 3}